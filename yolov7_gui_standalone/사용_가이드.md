# YOLOv7 Training GUI - 상세 사용 가이드

## 📑 목차

1. [설치 및 환경 구성](#1-설치-및-환경-구성)
2. [Python으로 직접 실행하기](#2-python으로-직접-실행하기)
3. [EXE 파일 빌드 및 배포](#3-exe-파일-빌드-및-배포)
4. [GUI 사용 방법](#4-gui-사용-방법)
5. [문제 해결](#5-문제-해결)

---

## 1. 설치 및 환경 구성

### 1.1 시스템 요구사항

**최소 사양:**
- OS: Windows 10 (64-bit)
- RAM: 8GB
- 저장 공간: 10GB
- GPU: NVIDIA GPU (권장, CPU도 가능하지만 매우 느림)

**권장 사양:**
- OS: Windows 11 (64-bit)
- RAM: 16GB 이상
- 저장 공간: 20GB 이상
- GPU: NVIDIA GPU 8GB VRAM 이상 (RTX 3060 이상)

### 1.2 필수 소프트웨어

1. **Anaconda 또는 Miniconda**
   - 다운로드: https://www.anaconda.com/download
   - Python 3.8-3.10 지원 (3.11은 일부 패키지 호환성 문제)

2. **NVIDIA CUDA 11.6** (GPU 사용 시)
   - 다운로드: https://developer.nvidia.com/cuda-11-6-0-download-archive
   - GPU 드라이버도 최신 버전으로 업데이트 필요

3. **Git** (소스 코드 다운로드용)
   - 다운로드: https://git-scm.com/download/win

### 1.3 프로젝트 다운로드

```bash
# 1. 작업 폴더 생성
mkdir C:\yolov7_project
cd C:\yolov7_project

# 2. YOLOv7 원본 레포지토리 클론
git clone https://github.com/WongKinYiu/yolov7.git

# 3. 이 프로젝트 클론
git clone <your-repo-url> yolo_train
cd yolo_train
```

**폴더 구조 확인:**
```
C:\yolov7_project\
├── yolov7/                  ← YOLOv7 원본 (필수!)
│   ├── train.py
│   ├── test.py
│   ├── models/
│   └── ...
└── yolo_train/              ← 이 프로젝트
    ├── yolov7_gui_standalone/
    └── ...
```

---

## 2. Python으로 직접 실행하기

### 2.1 환경 구성

```bash
# 1. Conda 환경 생성
cd C:\yolov7_project\yolo_train
conda env create -f environment.yaml

# 2. 환경 활성화
conda activate yolov7

# 3. PyTorch 설치 (CUDA 11.6)
pip install torch==1.13.1+cu116 torchvision==0.14.1+cu116 --extra-index-url https://download.pytorch.org/whl/cu116

# CPU만 사용하는 경우 (권장하지 않음)
# pip install torch==1.13.1 torchvision==0.14.1

# 4. 추가 의존성 설치
pip install matplotlib pyyaml opencv-python pillow tqdm
```

### 2.2 환경 확인

```bash
# Python 버전 확인
python --version
# 출력 예: Python 3.10.x

# PyTorch 설치 확인
python -c "import torch; print(f'PyTorch: {torch.__version__}')"
# 출력 예: PyTorch: 1.13.1+cu116

# CUDA 사용 가능 여부 확인
python -c "import torch; print(f'CUDA Available: {torch.cuda.is_available()}')"
# 출력 예: CUDA Available: True
```

### 2.3 GUI 실행

```bash
# 1. GUI 폴더로 이동
cd yolov7_gui_standalone

# 2. 실행
python main.py
```

**실행 성공 시:**
- GUI 창이 나타남
- 콘솔에 초기화 메시지 표시
- "YOLOv7 Training GUI - Ready" 상태

**실행 실패 시:**
- 에러 메시지 확인
- [문제 해결](#5-문제-해결) 섹션 참조

### 2.4 개발 모드 팁

**코드 수정 후 즉시 테스트:**
```bash
# 코드 수정
# → main.py 재실행
python main.py
```

**로그 확인:**
- GUI 실행 중 콘솔에서 실시간 로그 확인
- 훈련 로그: `outputs/runs/train/exp/train.log`

**디버깅:**
```python
# src/app.py 또는 다른 파일에 추가
import pdb; pdb.set_trace()  # 중단점 설정
```

---

## 3. EXE 파일 빌드 및 배포

### 3.1 빌드 준비

```bash
# 1. Python 환경 활성화
conda activate yolov7

# 2. PyInstaller 설치
pip install pyinstaller

# 3. GUI 폴더로 이동
cd C:\yolov7_project\yolo_train\yolov7_gui_standalone
```

### 3.2 EXE 빌드

**방법 1: 단일 폴더 방식 (권장)**

```bash
python build_exe.py onedir
```

**장점:**
- 빌드 속도 빠름 (~5분)
- 실행 속도 빠름
- 디버깅 용이

**단점:**
- 여러 파일로 구성 (폴더 전체 필요)

---

**방법 2: 단일 파일 방식**

```bash
python build_exe.py onefile
```

**장점:**
- 단일 .exe 파일
- 배포 간편

**단점:**
- 빌드 시간 김 (~10분)
- 실행 시 압축 해제로 느림
- 파일 크기 큼 (~1GB)

### 3.3 빌드 결과 확인

```
yolov7_gui_standalone/
├── build/                    # 임시 빌드 파일 (삭제 가능)
└── dist/
    └── YOLOv7_Training_GUI/  # ← 이 폴더를 배포
        ├── YOLOv7_Training_GUI.exe
        ├── _internal/        # DLL, 라이브러리
        │   ├── torch/
        │   ├── cv2/
        │   └── ...
        └── ...
```

### 3.4 배포 패키지 구성

**단계 1: 배포 폴더 생성**

```bash
# 배포용 최상위 폴더 생성
mkdir C:\YOLOv7_Training_Package
```

**단계 2: EXE 폴더 복사**

```bash
# 빌드된 EXE 폴더 복사
xcopy /E /I dist\YOLOv7_Training_GUI C:\YOLOv7_Training_Package\YOLOv7_Training_GUI
```

**단계 3: YOLOv7 원본 복사**

```bash
# YOLOv7 원본 레포지토리 복사 (필수!)
xcopy /E /I C:\yolov7_project\yolov7 C:\YOLOv7_Training_Package\yolov7
```

**최종 구조:**

```
C:\YOLOv7_Training_Package\
├── YOLOv7_Training_GUI\
│   ├── YOLOv7_Training_GUI.exe  ← 실행 파일
│   └── _internal\
└── yolov7\                       ← YOLOv7 원본 (필수!)
    ├── train.py
    ├── test.py
    ├── models\
    ├── utils\
    ├── cfg\
    └── data\
```

### 3.5 배포 및 사용자 전달

**옵션 1: ZIP 압축**

```bash
# YOLOv7_Training_Package 폴더 전체를 ZIP으로 압축
# 파일 크기: 약 500MB - 1GB
```

**옵션 2: 인스톨러 생성 (고급)**

Inno Setup 사용:
1. Inno Setup 다운로드: https://jrsoftware.org/isinfo.php
2. `installer_script.iss` 작성
3. 인스톨러 생성

### 3.6 사용자 실행 방법

**사용자에게 전달할 안내:**

```
1. YOLOv7_Training_Package.zip 압축 해제
2. YOLOv7_Training_GUI 폴더로 이동
3. YOLOv7_Training_GUI.exe 더블 클릭
4. Python 설치 불필요!
```

**주의사항:**
- 폴더 구조 유지 필수 (yolov7/ 폴더 필요)
- 처음 실행 시 Windows Defender 경고 가능 (정상)
- NVIDIA GPU가 없으면 CPU로 자동 전환 (매우 느림)

---

## 4. GUI 사용 방법

### 4.1 첫 화면

GUI 실행 시 3개의 탭이 표시됩니다:

1. **Training Setup** - 훈련 설정
2. **Model Selection** - 모델 선택
3. **Advanced Settings** - 고급 설정

### 4.2 데이터셋 준비

**YOLO 형식 데이터셋 구조:**

```
my_dataset/
├── images/
│   ├── train/
│   │   ├── img1.jpg
│   │   ├── img2.jpg
│   │   └── ...
│   └── val/
│       ├── img1.jpg
│       └── ...
└── labels/
    ├── train/
    │   ├── img1.txt
    │   ├── img2.txt
    │   └── ...
    └── val/
        ├── img1.txt
        └── ...
```

**data.yaml 작성:**

```yaml
train: C:/my_dataset/images/train
val: C:/my_dataset/images/val

nc: 3  # 클래스 개수
names: ['person', 'car', 'dog']  # 클래스 이름
```

### 4.3 훈련 시작 단계별 가이드

**Step 1: Dataset 설정**

1. "Training Setup" 탭 선택
2. "Dataset Config" 섹션에서 "Browse" 클릭
3. `data.yaml` 파일 선택
4. 하단에 "Dataset: my_dataset (3 classes)" 표시 확인

**Step 2: Model 선택**

1. "Model Selection" 탭으로 이동
2. YOLOv7 변형 선택:
   - **YOLOv7 (Default)** - 균형잡힌 성능 (권장)
   - **YOLOv7-Tiny** - 빠르고 가벼움 (모바일/임베디드)
   - **YOLOv7-X** - 최고 정확도 (큰 GPU 필요)
   - **YOLOv7-W6** - 1280 해상도
   - **YOLOv7-E6** - 1280 해상도, 높은 정확도
   - **YOLOv7-D6** - 1280 해상도
   - **YOLOv7-E6E** - 최고 성능 (매우 큰 GPU 필요)

3. 가중치 옵션 선택:
   - **처음부터 (From Scratch)** - 랜덤 초기화
   - **공식 가중치 (Official Weights)** - COCO 사전 학습 (권장)
   - **커스텀 가중치 (Custom Weights)** - 자신의 체크포인트

**Step 3: Training Parameters 설정**

1. **Epochs**: 훈련 반복 횟수 (기본: 100)
   - 작은 데이터셋: 100-200
   - 큰 데이터셋: 300-500

2. **Batch Size**: 배치 크기 (기본: 16)
   - GPU 메모리에 따라 조정:
     - 8GB VRAM: 8-16
     - 12GB VRAM: 16-32
     - 24GB VRAM: 32-64

3. **Image Size**: 입력 이미지 크기 (기본: 640)
   - 작은 객체: 1280
   - 일반: 640
   - 빠른 훈련: 416

4. **Device**: GPU 선택
   - 0: 첫 번째 GPU
   - 1: 두 번째 GPU
   - cpu: CPU 사용 (느림)

**Step 4: Hyperparameters (선택사항)**

1. "Advanced Settings" 탭 선택
2. 옵션:
   - **YOLOv7 Default** - 기본값 사용 (권장)
   - **Custom Preset** - 사전 정의된 설정
   - **Custom YAML** - 자신의 hyp.yaml

**Step 5: 훈련 시작**

1. 모든 설정 확인
2. "🚀 Start Training" 버튼 클릭
3. 확인 다이얼로그에서 "Yes" 클릭

### 4.4 훈련 모니터링

**실시간 차트:**
- **Loss 그래프**: Box, Object, Class Loss
- **Metrics 그래프**: Precision, Recall, mAP
- 자동 갱신 (10초마다)

**Best Models 추적:**
- **Best Precision**: 가장 높은 정밀도
- **Best Recall**: 가장 높은 재현율
- **Best Balance**: Precision과 Recall 균형
- **Best mAP**: 가장 높은 mAP@0.5

**진행 상황:**
- Current Epoch: 현재 에폭
- Elapsed Time: 경과 시간
- Estimated Remaining: 예상 남은 시간

### 4.5 훈련 제어

**일시정지:**
- "⏸ Pause Training" 버튼 클릭
- 현재 에폭 완료 후 정지
- 체크포인트 자동 저장

**재개:**
- "▶ Resume Training" 버튼 클릭
- 마지막 체크포인트부터 계속

**중지:**
- "⏹ Stop Training" 버튼 클릭
- 확인 다이얼로그
- 현재까지의 best.pt 저장됨

### 4.6 훈련 결과 확인

**결과 폴더:**

```
yolov7_gui_standalone/outputs/runs/train/exp/
├── weights/
│   ├── best.pt          # 최고 성능 모델
│   ├── last.pt          # 마지막 에폭 모델
│   ├── epoch_50.pt      # 중간 체크포인트
│   └── ...
├── train.log            # 훈련 로그
├── results.png          # 결과 그래프
├── confusion_matrix.png # 혼동 행렬
└── ...
```

**모델 사용:**

```python
# 추론 예제
python detect.py --weights outputs/runs/train/exp/weights/best.pt \
                 --source test_images/ \
                 --conf 0.5
```

---

## 5. 문제 해결

### 5.1 공통 문제

**문제: "YOLOv7 레포지토리를 찾을 수 없습니다"**

**원인:**
- yolov7/ 폴더가 올바른 위치에 없음

**해결:**
1. yolov7/ 폴더 위치 확인
2. 환경 변수 설정:
   ```bash
   set YOLOV7_PATH=C:\yolov7_project\yolov7
   ```
3. 또는 프로젝트 루트에 yolov7/ 배치

---

**문제: "CUDA out of memory"**

**원인:**
- Batch Size가 GPU 메모리보다 큼

**해결:**
1. Batch Size 줄이기 (16 → 8 → 4)
2. Image Size 줄이기 (640 → 416)
3. Workers 줄이기 (8 → 4)
4. 다른 프로그램 종료

---

**문제: "ModuleNotFoundError: No module named 'torch'"**

**원인:**
- PyTorch가 설치되지 않음

**해결:**
```bash
conda activate yolov7
pip install torch==1.13.1+cu116 torchvision==0.14.1+cu116 --extra-index-url https://download.pytorch.org/whl/cu116
```

---

**문제: 훈련이 매우 느림**

**원인:**
- CPU로 훈련 중 (GPU 미사용)

**확인:**
```python
import torch
print(torch.cuda.is_available())  # True여야 함
print(torch.cuda.get_device_name(0))  # GPU 이름 표시
```

**해결:**
1. NVIDIA GPU 드라이버 업데이트
2. CUDA 11.6 설치 확인
3. PyTorch CUDA 버전 재설치

---

**문제: EXE 실행 시 "Windows에서 PC 보호" 경고**

**원인:**
- 서명되지 않은 실행 파일 (정상)

**해결:**
1. "추가 정보" 클릭
2. "실행" 버튼 클릭
3. 정상적으로 실행됨

---

### 5.2 로그 확인

**GUI 실행 로그:**
```
yolov7_gui_standalone/error.log
```

**훈련 로그:**
```
yolov7_gui_standalone/outputs/runs/train/exp/train.log
```

**디버그 모드 실행:**
```bash
python main.py --debug
```

---

### 5.3 지원

**문서:**
- [README.md](../README.md)
- [EXE_사용_가이드.md](EXE_사용_가이드.md)

**이슈 보고:**
- GitHub Issues
- 에러 로그 첨부 필수

**커뮤니티:**
- YOLOv7 공식: https://github.com/WongKinYiu/yolov7/issues

---

## 📚 부록

### A. 권장 훈련 설정

**작은 데이터셋 (< 1000 이미지):**
```
Epochs: 150-200
Batch Size: 8-16
Image Size: 640
Model: YOLOv7 (Default)
```

**중간 데이터셋 (1000-10000 이미지):**
```
Epochs: 200-300
Batch Size: 16-32
Image Size: 640
Model: YOLOv7 또는 YOLOv7-X
```

**큰 데이터셋 (> 10000 이미지):**
```
Epochs: 300-500
Batch Size: 32-64
Image Size: 640-1280
Model: YOLOv7-X 또는 YOLOv7-E6
```

### B. GPU별 권장 설정

**RTX 3060 (12GB):**
```
Batch Size: 16-24
Image Size: 640
Model: YOLOv7, YOLOv7-X
```

**RTX 3080 (10GB):**
```
Batch Size: 16-32
Image Size: 640
Model: YOLOv7-X
```

**RTX 3090 / 4090 (24GB):**
```
Batch Size: 32-64
Image Size: 640-1280
Model: YOLOv7-E6, YOLOv7-E6E
```

**RTX 2060 (6GB):**
```
Batch Size: 8-12
Image Size: 416-640
Model: YOLOv7, YOLOv7-Tiny
```

---

**Made with ❤️ for the Computer Vision Community**
